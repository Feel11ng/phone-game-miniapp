<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Phone Tycoon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6c5ce7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <title>Phone Game</title>
    <!-- Preload critical resources -->
    <link rel="preload" href="sounds.js" as="script">
    <link rel="preload" href="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" as="audio" type="audio/mp3">
    <link rel="preload" href="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-991.mp3" as="audio" type="audio/mp3">
    <meta name="theme-color" content="#6C5CE7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <style>
        /* Critical CSS for initial load */
        body { 
            opacity: 0; 
            transition: opacity 0.3s ease-in-out;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .app-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-color);
            z-index: 9999;
            transition: opacity 0.3s ease-in-out;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(108, 92, 231, 0.1);
            border-radius: 50%;
            display: inline-block;
            position: relative;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        .loader::after {
            content: '';  
            box-sizing: border-box;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-bottom-color: var(--primary);
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="sounds.js" as="script">
    <link rel="preload" href="api.js" as="script">
    <link rel="preload" href="errorHandler.js" as="script">
    <link rel="preload" href="animations.js" as="script">
    
    <!-- Load scripts with proper attributes -->
    <script src="sounds.js" type="module"></script>
    <script src="api.js" type="module"></script>
    <script src="errorHandler.js" type="module"></script>
    <script src="animations.js" type="module"></script>
    
    <!-- Main script with defer to ensure all modules are loaded -->
    <script src="script.js" type="module" defer></script>
    <script>
        // Show loading state while resources are loading
        document.addEventListener('DOMContentLoaded', () => {
            // Preload critical sounds
            const soundManager = new SoundManager();
            
            // When everything is loaded
            window.addEventListener('load', () => {
                // Fade in the app
                document.body.style.opacity = '1';
                
                // Hide loading screen with a delay
                const loadingScreen = document.querySelector('.app-loading');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 300);
                }
                
                // Play welcome sound
                soundManager.play('notification');
                
                // Haptic feedback for app ready
                soundManager.hapticFeedback('light');
            });
        });
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div class="app-loading">
        <div class="loader"></div>
        <p style="margin-top: 16px; color: var(--text); font-weight: 500;">Загрузка...</p>
    </div>
    <div class="app">
        <!-- Верхняя панель с балансом -->
        <header class="app-header">
            <div class="balance-card">
                <i class="fas fa-bolt"></i>
                <span id="signals-count">0</span> Сигналов
            </div>
            <div class="user-avatar" id="user-avatar">
                <i class="fas fa-user"></i>
            </div>
        </header>

        <!-- Основное содержимое -->
        <main class="main-content" id="main-content">
            <!-- Главная страница -->
            <section id="home-section" class="page active">
                <div class="welcome-banner">
                    <h1>Добро пожаловать в Phone Tycoon!</h1>
                    <p>Собирай, улучшай и продавай виртуальные телефоны</p>
                </div>
                
                <div class="quick-actions">
                    <div class="action-card" data-section="inventory">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Инвентарь</span>
                    </div>
                    <div class="action-card" data-section="cases">
                        <i class="fas fa-gift"></i>
                        <span>Кейсы</span>
                    </div>
                    <div class="action-card" data-section="market">
                        <i class="fas fa-store"></i>
                        <span>Рынок</span>
                    </div>
                </div>

                <div class="recent-activity">
                    <h2>Последние действия</h2>
                    <div class="activity-list" id="activity-feed">
                        <div class="activity-item">Добро пожаловать в игру!</div>
                    </div>
                </div>
            </section>

            <!-- Раздел инвентаря -->
            <section id="inventory-section" class="page">
                <div class="section-header">
                    <h2>Ваша коллекция</h2>
                    <div class="filters">
                        <button class="filter-btn active">Все</button>
                        <button class="filter-btn">Обычные</button>
                        <button class="filter-btn">Редкие</button>
                        <button class="filter-btn">Эпические</button>
                        <button class="filter-btn">Легендарные</button>
                    </div>
                </div>
                <div id="inventory-list" class="phone-grid">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Загрузка коллекции...</p>
                    </div>
                </div>
            </section>

            <!-- Раздел кейсов -->
            <section id="cases-section" class="page">
                <h2>Кейсы</h2>
                <div class="cases-grid">
                    <div class="case-card" data-case-id="1">
                        <div class="case-image">
                            <img src="https://via.placeholder.com/120" alt="Базовый кейс">
                        </div>
                        <div class="case-info">
                            <h3>Базовый кейс</h3>
                            <div class="case-price">
                                <i class="fas fa-bolt"></i> 50
                            </div>
                            <button class="btn open-case-btn" data-case-id="1">Открыть</button>
                        </div>
                    </div>
                    <!-- Другие кейсы будут добавлены динамически -->
                </div>

                <div id="case-result" class="case-result-modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>Поздравляем!</h3>
                        <div class="prize-animation">
                            <div class="phone-reveal">
                                <img id="result-phone-img" src="" alt="Новый телефон">
                            </div>
                            <div class="confetti"></div>
                        </div>
                        <p id="result-phone-name" class="prize-name"></p>
                        <p class="prize-rarity"></p>
                        <button class="btn" id="close-result">Отлично!</button>
                    </div>
                </div>
            </section>

            <!-- Раздел рынка -->
            <section id="market-section" class="page">
                <div class="market-tabs">
                    <button class="tab-btn active" data-tab="buy">Купить</button>
                    <button class="tab-btn" data-tab="sell">Продать</button>
                    <button class="tab-btn" data-tab="my-sales">Мои продажи</button>
                </div>
                
                <!-- Вкладка покупки -->
                <div class="tab-content active" id="buy-tab">
                    <div class="market-filters">
                        <select class="filter-select" id="market-filter">
                            <option value="all">Все телефоны</option>
                            <option value="common">Обычные</option>
                            <option value="uncommon">Необычные</option>
                            <option value="rare">Редкие</option>
                            <option value="legendary">Легендарные</option>
                        </select>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="market-search" placeholder="Поиск по названию...">
                        </div>
                    </div>
                    <div id="market-items" class="market-items">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Загрузка товаров...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка продажи -->
                <div class="tab-content" id="sell-tab">
                    <div class="sell-interface">
                        <h3>Выберите телефон для продажи</h3>
                        <div class="inventory-list" id="sell-phone-list">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <p>Загрузка инвентаря...</p>
                            </div>
                        </div>
                        <div class="sell-tip">
                            <i class="fas fa-info-circle"></i>
                            <p>Вы получите 90% от указанной цены (10% - комиссия площадки)</p>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка мои продажи -->
                <div class="tab-content" id="my-sales-tab">
                    <div class="my-sales">
                        <h3>Мои продажи</h3>
                        <div class="sales-list" id="sales-list">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <p>Загрузка ваших продаж...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Профиль пользователя -->
            <section id="profile-section" class="page">
                <div class="profile-header">
                    <div class="profile-avatar" id="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2 id="username">Игрок</h2>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value" id="total-phones">0</div>
                            <div class="stat-label">Телефоны</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="total-cases">0</div>
                            <div class="stat-label">Кейсы</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="total-sales">0</div>
                            <div class="stat-label">Продажи</div>
                        </div>
                    </div>
                </div>

                <div class="profile-actions">
                    <button class="btn btn-outline" id="settings-btn">
                        <i class="fas fa-cog"></i> Настройки
                    </button>
                    <button class="btn btn-outline" id="help-btn">
                        <i class="fas fa-question-circle"></i> Помощь
                    </button>
                    <button class="btn btn-outline" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </button>
                </div>
            </section>
        </main>

        <!-- Нижняя навигация -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-section="home">
                <i class="fas fa-home"></i>
                <span>Главная</span>
            </a>
            <a href="#" class="nav-item" data-section="inventory">
                <i class="fas fa-mobile-alt"></i>
                <span>Инвентарь</span>
            </a>
            <a href="#" class="nav-item" data-section="cases">
                <i class="fas fa-gift"></i>
                <span>Кейсы</span>
            </a>
            <a href="#" class="nav-item" data-section="market">
                <i class="fas fa-store"></i>
                <span>Рынок</span>
            </a>
            <a href="#" class="nav-item" data-section="profile">
                <i class="fas fa-user"></i>
                <span>Профиль</span>
            </a>
        </nav>

        <!-- Уведомления -->
        <div id="notification" class="notification"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
